#!/usr/bin/env bash

TARGETS="AArch64;ARM;X86;Mips;RISCV"
EXPERIMENTAL_TARGETS="MMIX;Lanai;BPF"
SRC=~/code/llvm/llvm-project/llvm
BUILD_TYPE=Debug
ASSERTIONS=ON
SPLIT_DWARF=ON

if [ $# -eq 3 ]; then
    SRC=$1
    TARGETS=$2
    EXPERIMENTAL_TARGETS=$3
    BUILD_TYPE=Release
    ASSERTIONS=OFF
    SPLIT_DWARF=OFF
fi

cmake $SRC \
   -DCMAKE_C_FLAGS="-pg" \
   -DCMAKE_CXX_FLAGS="-pg" \
   -DCMAKE_BUILD_TYPE=$BUILD_TYPE \
   -DLLVM_USE_SPLIT_DWARF=$SPLIT_DWARF \
   -DLLVM_ENABLE_ASSERTIONS=$ASSERTIONS \
   -DCMAKE_EXPORT_COMPILE_COMMANDS=1 \
   -DLLVM_PARALLEL_LINK_JOBS=4 \
   -DBUILD_SHARED_LIBS=ON \
   -DLLVM_BUILD_TESTS=ON \
   -DLLVM_ENABLE_PROJECTS="clang;lld" \
   -DLLVM_TARGETS_TO_BUILD=$TARGETS \
   -DLLVM_EXPERIMENTAL_TARGETS_TO_BUILD=$EXPERIMENTAL_TARGETS \
   -G Ninja

#    -DLLVM_OPTIMIZED_TABLEGEN=ON \
